---
title:  从零打造极简流程图编辑器（1）
tags:
  - js
categories:   
  - 原创
---
## 写在前面
在前端领域提及编辑器，大部分人肯定会马上联想到富文本，但对于一些 to B 的项目中，流程编辑器也是一个很常见的底层组件，尤其是涉及流程概念的系统，比如 oa 系统、审批类的管理系统等等。公司项目中使用的流程图编辑器，是我公司老大根据 github 上一个 demo 项目改的，据他反馈，之前改造的时候，bug 特别多，基本属于改一半，写一半的状态。

我刚到公司时，正好接手这个项目，对于产品经理提出的关于流程编辑器的新需求真的非常头疼，因为稍微改一点功能，就会引发无数回归性的 bug。造成这种结果的原因有很多，最主要的是在最初的实现中，并没有经过很好的抽象与设计，同时底层的实现也简单的基于 canvas 和浏览器的事情系统，因此随着业务逻辑的增多，`if-else` 语句越写越多，状态越声明越多，事件注册逻辑越来越多，最终失控是必然的。

因此就想从头开始实现一个极简的流程图编辑器，一来温故知新，二来锻炼一下自己关于系统设计的能力。

## 功能清单及技术选型
要打造一个极简的编辑器，首先我们需要给极简下一个定义，换言之就是其具备的功能，我想了以下几点：
* 支持多种图形元素
* 提供即时拖拽、选取、变形、连线等功能
* 提供更改图形元素的文字及样式的接口
* 支持插件化，以提供扩展性
* 具有生命周期及事件系统
* 可以序列化

大概这样子应该就可以算的上一个极简流程图了。当然这只是大概的罗列一下即将实现的功能点，可能还会包含一些别的。

关于技术的选型，是基于上面的功能点来决定的，如下：
* 编辑器容器的实现选择使用 `canvas` 来做，对于**连线**这个功能实现起来方便一些
* 对于拖拽、点击等事件的抽象选择使用 `rxjs` 来做，因为对于编辑器中提供的各种操作，本身上均是事件驱动的，使用响应式的思想可以使我们将更多的注意力放在实现业务逻辑上
* 为了享受类型分析的便利性，这里使用 `typescript`，一来可以对一些对象类型进行抽象，二来可以使用一些 `OOP` 中涉及的概念，比如接口、抽象类等
* 对于一些状态的映射关系，比如选取操作最终的状态，使用函数式中涉及的 `Monad` 概念来抽象，这也可以算作第二点的一种延伸

说到这里，很多人可能要喷我了，你这也算的上极简？使用了这么多额外的库，了解它们可能也需要花不少时间，但是请放心，这里仅使用了它们提供的一些很基础的功能，以节省重复造轮子的时间，并且在读这篇文章的同时，还可以间接了解一下除编辑器以外的其他知识点。

## 